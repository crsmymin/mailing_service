<?xml version="1.0" encoding="UTF-8" ?>

<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="member">
	<select id="getGroupList" parameterType="String" resultType="GroupVO">
               <![CDATA[
                       SELECT group_id,
						    group_name,
						    req_date,
						    delet_date,
						    (select count(*) from mail_member as m where g.group_id = m.group_id) AS member_cnt
						FROM reverse_mail.mail_group g
						WHERE delet_date IS NULL
               ]]>
     </select>
	 
	 <insert id="insertGroup" parameterType="java.util.List">
	    INSERT INTO mail_group (group_name) VALUES
	    <foreach collection="list" item="item" separator=" , " >
	        (#{item.group_name})
	    </foreach>
	</insert>
	
	 <update id="updateGroup" parameterType="java.util.List" >
	  <foreach collection="list" item="item" separator=" ; " >
	 	 update reverse_mail.mail_group set
		    group_name = #{item.group_name}
		  where group_id = #{item.group_id}
	   </foreach>
	</update>
     
     <select id="getMemberList" parameterType="String" resultType="MemberVO">
           SELECT member_id,
		    group_id,
		    (select group_name from mail_group as g where g.group_id = m.group_id) AS group_name,
		    member_name,
		    member_mail,
		    req_date,
		    delete_date,
		    rejection_date
		FROM reverse_mail.mail_member m
		WHERE 1=1
		<if test='value != null'>
			AND (member_name like CONCAT('%',#{0},'%') OR member_mail like CONCAT('%',#{0},'%'))
		</if>
     </select>
</mapper>
